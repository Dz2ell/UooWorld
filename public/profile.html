<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî UooWorld</title>
    <meta name="description" content="–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞ UooWorld">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="/js/i18n.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#0a0a0a', 800: '#121212', 700: '#1a1a1a', 600: '#242424' },
                        accent: { DEFAULT: '#22c55e', dark: '#16a34a', light: '#4ade80' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e2e8f0;
            min-height: 100vh;
        }

        body.theme-light {
            background-color: #f8fafc;
            color: #1e293b;
        }

        .theme-light .text-white {
            color: #1e293b !important;
        }

        .theme-light .text-gray-300 {
            color: #475569 !important;
        }

        .theme-light .text-gray-400 {
            color: #64748b !important;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .theme-light .glass-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .navbar-blur {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(20px);
        }

        .theme-light .navbar-blur {
            background: rgba(255, 255, 255, 0.9);
        }

        .grid-pattern {
            background-image:
                linear-gradient(rgba(34, 197, 94, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(34, 197, 94, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        .glow-green {
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.3);
        }

        .btn-primary {
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(34, 197, 94, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }

        .dropdown-menu {
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .dropdown:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .modal {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            transform: scale(0.95) translateY(20px);
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .wiki-infobox {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.02) 100%);
            border: 2px solid rgba(34, 197, 94, 0.2);
        }

        .role-badge {
            animation: roleGlow 2s ease-in-out infinite;
        }

        @keyframes roleGlow {

            0%,
            100% {
                box-shadow: 0 0 10px currentColor;
            }

            50% {
                box-shadow: 0 0 20px currentColor;
            }
        }

        .command-item {
            transition: all 0.2s ease;
        }

        .command-item:hover {
            background: rgba(34, 197, 94, 0.1);
            transform: translateX(4px);
        }
    </style>
</head>

<body class="grid-pattern">
    <!-- Navbar -->
    <nav class="fixed top-0 left-0 right-0 z-50 navbar-blur border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 sm:h-20">
                <a href="/" class="flex items-center space-x-3 group">
                    <div
                        class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-accent to-accent-dark rounded-xl flex items-center justify-center glow-green group-hover:scale-110 transition-transform duration-300">
                        <i class="fa-solid fa-cube text-dark-900 text-lg sm:text-xl"></i>
                    </div>
                    <span
                        class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">UooWorld</span>
                </a>

                <div class="flex items-center space-x-2 sm:space-x-4">
                    <!-- Server Status -->
                    <div id="serverStatus"
                        class="hidden sm:flex items-center space-x-2 bg-dark-700/50 px-3 py-1.5 rounded-lg border border-white/5">
                        <span class="w-2 h-2 rounded-full bg-gray-500" id="statusDot"></span>
                        <span class="text-sm text-gray-400" id="statusText">...</span>
                    </div>

                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="p-2 text-gray-400 hover:text-accent transition-colors">
                        <i class="fa-solid fa-moon text-lg"></i>
                    </button>

                    <!-- Language -->
                    <div class="dropdown relative">
                        <button
                            class="flex items-center space-x-1 p-2 text-gray-400 hover:text-accent transition-colors">
                            <span id="currentLangFlag">üá∑üá∫</span>
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </button>
                        <div
                            class="dropdown-menu absolute right-0 top-full mt-2 bg-dark-700 border border-white/10 rounded-xl overflow-hidden min-w-32 z-50">
                            <button onclick="changeLang('ru')"
                                class="w-full px-4 py-2 text-left hover:bg-accent/20 flex items-center space-x-2 text-gray-300">
                                <span>üá∑üá∫</span><span>–†—É—Å—Å–∫–∏–π</span>
                            </button>
                            <button onclick="changeLang('en')"
                                class="w-full px-4 py-2 text-left hover:bg-accent/20 flex items-center space-x-2 text-gray-300">
                                <span>üá¨üáß</span><span>English</span>
                            </button>
                            <button onclick="changeLang('uk')"
                                class="w-full px-4 py-2 text-left hover:bg-accent/20 flex items-center space-x-2 text-gray-300">
                                <span>üá∫üá¶</span><span>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</span>
                            </button>
                            <button onclick="changeLang('lv')"
                                class="w-full px-4 py-2 text-left hover:bg-accent/20 flex items-center space-x-2 text-gray-300">
                                <span>üá±üáª</span><span>Latvie≈°u</span>
                            </button>
                        </div>
                    </div>

                    <div class="hidden sm:flex items-center space-x-4">
                        <a href="/" class="text-gray-300 hover:text-accent transition-colors"
                            data-i18n="nav_home">–ì–ª–∞–≤–Ω–∞—è</a>
                        <a href="https://discord.gg/qqPYusFe9b" target="_blank"
                            class="text-gray-300 hover:text-accent transition-colors">Discord</a>
                    </div>

                    <button id="logoutBtn"
                        class="flex items-center space-x-2 text-gray-400 hover:text-red-400 transition-colors">
                        <i class="fa-solid fa-sign-out-alt"></i>
                        <span class="hidden sm:inline" data-i18n="nav_logout">–í—ã–π—Ç–∏</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Wiki-style Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Left: Wiki Infobox Card -->
                <div class="lg:col-span-1">
                    <div class="wiki-infobox rounded-2xl p-6 sticky top-24">
                        <!-- Avatar -->
                        <div class="text-center mb-6">
                            <div class="w-32 h-32 mx-auto bg-gradient-to-br from-accent to-accent-dark rounded-2xl flex items-center justify-center text-5xl font-bold text-dark-900 mb-4"
                                id="avatarLarge">?</div>
                            <h1 class="text-2xl font-bold text-white" id="usernameDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>

                            <!-- Role Badge -->
                            <div class="mt-3">
                                <span
                                    class="role-badge inline-flex items-center px-4 py-1.5 rounded-full text-sm font-semibold"
                                    id="roleBadge" style="background: rgba(148, 163, 184, 0.2); color: #94a3b8;">
                                    <i class="fa-solid fa-user mr-2"></i>
                                    <span id="roleText">–ò–≥—Ä–æ–∫</span>
                                </span>
                            </div>
                        </div>

                        <!-- Info Table -->
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between py-2 border-b border-white/10">
                                <span class="text-gray-400">
                                    <i class="fa-solid fa-gamepad mr-2 text-accent"></i>
                                    Minecraft
                                </span>
                                <span class="text-white font-medium" id="minecraftDisplay">‚Äî</span>
                            </div>
                            <div class="flex justify-between py-2 border-b border-white/10">
                                <span class="text-gray-400">
                                    <i class="fa-brands fa-discord mr-2 text-accent"></i>
                                    Discord
                                </span>
                                <span class="text-white font-medium" id="discordDisplay">‚Äî</span>
                            </div>
                            <div class="flex justify-between py-2 border-b border-white/10">
                                <span class="text-gray-400">
                                    <i class="fa-solid fa-calendar mr-2 text-accent"></i>
                                    <span data-i18n="profile_member_since">–£—á–∞—Å—Ç–Ω–∏–∫ —Å</span>
                                </span>
                                <span class="text-white font-medium" id="joinDate">‚Äî</span>
                            </div>
                            <div class="flex justify-between py-2">
                                <span class="text-gray-400">
                                    <i class="fa-solid fa-star mr-2 text-accent"></i>
                                    –£—Ä–æ–≤–µ–Ω—å
                                </span>
                                <span class="text-white font-medium" id="levelDisplay">1</span>
                            </div>
                        </div>

                        <!-- Settings Button -->
                        <button id="openSettingsBtn"
                            class="w-full mt-6 bg-dark-700/50 hover:bg-dark-600 border border-white/10 text-gray-300 hover:text-white py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center space-x-2">
                            <i class="fa-solid fa-cog"></i>
                            <span data-i18n="nav_settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                        </button>
                    </div>
                </div>

                <!-- Right: Main Content -->
                <div class="lg:col-span-2 space-y-6">

                    <!-- Bio Section -->
                    <div class="glass-card rounded-2xl p-6">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fa-solid fa-quote-left text-accent mr-3"></i>
                            <span data-i18n="profile_bio">–û —Å–µ–±–µ</span>
                        </h2>
                        <p class="text-gray-300 leading-relaxed whitespace-pre-wrap" id="bioDisplay">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞
                            –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª –æ —Å–µ–±–µ...</p>
                    </div>

                    <!-- Discord Publish -->
                    <div class="glass-card rounded-2xl p-6">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fa-brands fa-discord text-[#5865F2] mr-3"></i>
                            <span data-i18n="profile_publish">–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Discord</span>
                        </h2>
                        <p class="text-gray-400 mb-4">–ü–æ–¥–µ–ª–∏—Å—å —Å–≤–æ–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º!</p>

                        <!-- Preview -->
                        <div class="bg-[#2f3136] rounded-xl p-4 mb-4">
                            <div class="flex items-start space-x-3">
                                <div class="w-10 h-10 rounded-full bg-accent flex items-center justify-center text-dark-900 font-bold text-sm"
                                    id="previewAvatar">?</div>
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-1">
                                        <span class="font-semibold text-white">UooWorld Bot</span>
                                        <span class="bg-[#5865F2] text-white text-xs px-1.5 py-0.5 rounded">BOT</span>
                                    </div>
                                    <div class="bg-[#202225] rounded-lg p-3 border-l-4 border-accent text-sm">
                                        <p class="text-white font-semibold mb-2">üéÆ –ü—Ä–æ—Ñ–∏–ª—å: <span
                                                id="previewUsername">‚Äî</span></p>
                                        <p class="text-gray-300">‚õèÔ∏è Minecraft: <span id="previewMinecraft"
                                                class="text-white">‚Äî</span></p>
                                        <p class="text-gray-300">üí¨ Discord: <span id="previewDiscord"
                                                class="text-white">‚Äî</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button id="publishBtn"
                            class="w-full bg-[#5865F2] hover:bg-[#4752C4] text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center space-x-2 transition-all">
                            <i class="fa-brands fa-discord"></i>
                            <span data-i18n="profile_publish">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ Discord</span>
                        </button>
                    </div>

                    <!-- Role Commands (Staff Only) -->
                    <div id="commandsSection" class="hidden glass-card rounded-2xl p-6">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fa-solid fa-terminal text-accent mr-3"></i>
                            <span data-i18n="profile_commands">–ö–æ–º–∞–Ω–¥—ã —Ä–æ–ª–∏</span>
                        </h2>
                        <p class="text-gray-400 mb-4">–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–º –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:</p>
                        <div id="commandsList" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal"
        class="modal fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
        <div class="modal-content glass-card rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <!-- Modal Header -->
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <i class="fa-solid fa-user-pen text-accent mr-3"></i>
                        <span data-i18n="profile_settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</span>
                    </h2>
                    <button id="closeSettingsBtn" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>

                <!-- Messages -->
                <div id="settingsSuccess" class="hidden bg-green-500/10 border border-green-500/30 rounded-xl p-4 mb-4">
                    <p class="text-green-400 text-sm text-center flex items-center justify-center space-x-2">
                        <i class="fa-solid fa-check-circle"></i>
                        <span data-i18n="profile_saved">–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!</span>
                    </p>
                </div>
                <div id="settingsError" class="hidden bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-4">
                    <p class="text-red-400 text-sm text-center" id="settingsErrorText"></p>
                </div>

                <!-- Form -->
                <form id="settingsForm" class="space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fa-solid fa-gamepad mr-1 text-accent"></i>
                            <span data-i18n="profile_minecraft">Minecraft –Ω–∏–∫</span>
                        </label>
                        <input type="text" id="edit_minecraft"
                            class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500"
                            placeholder="Steve">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fa-brands fa-discord mr-1 text-accent"></i>
                            Discord
                        </label>
                        <input type="text" id="edit_discord"
                            class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500"
                            placeholder="username">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fa-solid fa-comment mr-1 text-accent"></i>
                            <span data-i18n="profile_bio">–û —Å–µ–±–µ</span>
                        </label>
                        <textarea id="edit_bio" rows="4"
                            class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500 resize-none"
                            data-i18n="profile_bio_placeholder" placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –Ω–µ–º–Ω–æ–≥–æ –æ —Å–µ–±–µ..."></textarea>
                    </div>

                    <button type="submit" id="saveSettingsBtn"
                        class="btn-primary w-full bg-accent hover:bg-accent-dark text-dark-900 font-bold py-3 px-6 rounded-xl flex items-center justify-center space-x-2">
                        <i class="fa-solid fa-save"></i>
                        <span data-i18n="profile_save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;

        // Role colors
        const ROLE_COLORS = {
            1: { bg: 'rgba(148, 163, 184, 0.2)', color: '#94a3b8', name: '–ò–≥—Ä–æ–∫', icon: 'fa-user' },
            2: { bg: 'rgba(34, 211, 238, 0.2)', color: '#22d3ee', name: '–•–µ–ª–ø–µ—Ä', icon: 'fa-headset' },
            3: { bg: 'rgba(167, 139, 250, 0.2)', color: '#a78bfa', name: '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä', icon: 'fa-shield' },
            4: { bg: 'rgba(244, 63, 94, 0.2)', color: '#f43f5e', name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', icon: 'fa-crown' }
        };

        // Load profile
        async function loadProfile() {
            try {
                const response = await fetch('/api/auth/me');
                if (!response.ok) {
                    window.location.href = '/login.html';
                    return;
                }

                const data = await response.json();
                currentUser = data.user;

                // Update display
                document.getElementById('usernameDisplay').textContent = currentUser.username;
                document.getElementById('avatarLarge').textContent = currentUser.username.charAt(0).toUpperCase();
                document.getElementById('previewAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
                document.getElementById('previewUsername').textContent = currentUser.username;

                document.getElementById('minecraftDisplay').textContent = currentUser.minecraft_username || '‚Äî';
                document.getElementById('discordDisplay').textContent = currentUser.discord_username || '‚Äî';
                document.getElementById('previewMinecraft').textContent = currentUser.minecraft_username || '‚Äî';
                document.getElementById('previewDiscord').textContent = currentUser.discord_username || '‚Äî';
                document.getElementById('levelDisplay').textContent = currentUser.level || 1;

                if (currentUser.bio) {
                    document.getElementById('bioDisplay').textContent = currentUser.bio;
                }

                // Join date
                const joinDate = new Date(currentUser.created_at);
                document.getElementById('joinDate').textContent = joinDate.toLocaleDateString(getCurrentLang() === 'en' ? 'en-US' : 'ru-RU', {
                    year: 'numeric',
                    month: 'short'
                });

                // Fill settings form
                document.getElementById('edit_minecraft').value = currentUser.minecraft_username || '';
                document.getElementById('edit_discord').value = currentUser.discord_username || '';
                document.getElementById('edit_bio').value = currentUser.bio || '';

                // Role badge
                updateRoleBadge(currentUser.level || 1);

                // Load commands for staff
                if (currentUser.level >= 2) {
                    loadCommands(currentUser.level);
                }

            } catch (err) {
                console.error('Failed to load profile:', err);
                window.location.href = '/login.html';
            }
        }

        function updateRoleBadge(level) {
            const role = ROLE_COLORS[level] || ROLE_COLORS[1];
            const badge = document.getElementById('roleBadge');
            const roleText = document.getElementById('roleText');

            badge.style.background = role.bg;
            badge.style.color = role.color;
            badge.querySelector('i').className = `fa-solid ${role.icon} mr-2`;
            roleText.textContent = role.name;
        }

        async function loadCommands(level) {
            try {
                const response = await fetch(`/api/roles/${level}/commands`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.commands && data.commands.length > 0) {
                        document.getElementById('commandsSection').classList.remove('hidden');
                        const list = document.getElementById('commandsList');
                        list.innerHTML = data.commands.map(cmd => `
                            <div class="command-item flex items-start space-x-3 p-3 rounded-lg border border-white/5">
                                <code class="text-accent font-mono text-sm shrink-0">${cmd.cmd}</code>
                                <span class="text-gray-400 text-sm">${cmd.desc}</span>
                            </div>
                        `).join('');
                    }
                }
            } catch (err) {
                console.error('Failed to load commands:', err);
            }
        }

        // Settings modal
        const modal = document.getElementById('settingsModal');
        document.getElementById('openSettingsBtn').addEventListener('click', () => modal.classList.add('show'));
        document.getElementById('closeSettingsBtn').addEventListener('click', () => modal.classList.remove('show'));
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.classList.remove('show');
        });

        // Save settings
        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveSettingsBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

            try {
                const response = await fetch('/api/profile', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        minecraft_username: document.getElementById('edit_minecraft').value,
                        discord_username: document.getElementById('edit_discord').value,
                        bio: document.getElementById('edit_bio').value
                    })
                });

                if (response.ok) {
                    document.getElementById('settingsSuccess').classList.remove('hidden');
                    document.getElementById('settingsError').classList.add('hidden');
                    setTimeout(() => modal.classList.remove('show'), 1500);
                    loadProfile(); // Refresh
                } else {
                    const data = await response.json();
                    document.getElementById('settingsErrorText').textContent = data.error;
                    document.getElementById('settingsError').classList.remove('hidden');
                }
            } catch (err) {
                document.getElementById('settingsErrorText').textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
                document.getElementById('settingsError').classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-save"></i> <span>' + t('profile_save') + '</span>';
            }
        });

        // Publish to Discord
        document.getElementById('publishBtn').addEventListener('click', async () => {
            const btn = document.getElementById('publishBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

            try {
                const response = await fetch('/api/profile/publish', { method: 'POST' });
                const data = await response.json();

                if (response.ok) {
                    btn.innerHTML = '<i class="fa-solid fa-check"></i> ' + t('profile_published');
                    btn.className = 'w-full bg-green-500 text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center space-x-2';
                } else {
                    btn.innerHTML = '<i class="fa-solid fa-xmark"></i> ' + (data.error || '–û—à–∏–±–∫–∞');
                    btn.className = 'w-full bg-red-500 text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center space-x-2';
                }
            } catch (err) {
                btn.innerHTML = '<i class="fa-solid fa-xmark"></i> –û—à–∏–±–∫–∞';
            }

            setTimeout(() => {
                btn.disabled = false;
                btn.className = 'w-full bg-[#5865F2] hover:bg-[#4752C4] text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center space-x-2 transition-all';
                btn.innerHTML = '<i class="fa-brands fa-discord"></i> <span>' + t('profile_publish') + '</span>';
            }, 3000);
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await fetch('/api/auth/logout', { method: 'POST' });
            window.location.href = '/';
        });

        // Theme
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', () => {
            toggleTheme();
            themeToggle.querySelector('i').className = getCurrentTheme() === 'dark' ? 'fa-solid fa-moon text-lg' : 'fa-solid fa-sun text-lg';
        });
        themeToggle.querySelector('i').className = getCurrentTheme() === 'dark' ? 'fa-solid fa-moon text-lg' : 'fa-solid fa-sun text-lg';

        // Language
        function changeLang(lang) {
            setLang(lang);
            document.getElementById('currentLangFlag').textContent = { ru: 'üá∑üá∫', en: 'üá¨üáß', uk: 'üá∫üá¶', lv: 'üá±üáª' }[lang];
        }
        document.getElementById('currentLangFlag').textContent = { ru: 'üá∑üá∫', en: 'üá¨üáß', uk: 'üá∫üá¶', lv: 'üá±üáª' }[getCurrentLang()];

        // Server status
        async function checkServerStatus() {
            try {
                const response = await fetch('https://api.mcsrvstat.us/3/play.uooworld.net');
                const data = await response.json();
                const dot = document.getElementById('statusDot');
                const text = document.getElementById('statusText');
                if (data.online) {
                    dot.className = 'w-2 h-2 rounded-full bg-green-500 animate-pulse';
                    text.textContent = `${data.players?.online || 0} ${t('status_players')}`;
                    text.className = 'text-sm text-green-400';
                } else {
                    dot.className = 'w-2 h-2 rounded-full bg-red-500';
                    text.textContent = t('status_offline');
                    text.className = 'text-sm text-red-400';
                }
            } catch (err) { }
        }
        checkServerStatus();

        // Init
        loadProfile();
    </script>
</body>

</html>